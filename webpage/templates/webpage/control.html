{% extends 'webpage/base.html' %}

{% block control-a %}active{% endblock %}

{% block content %}
<div class="container-xxl">
    <div class="ar-control">
        <h1 class="titulo">Control de Producto</h1>
        <div class="">
            <form class="" method="post">
                {% csrf_token %}
                <input type="hidden" value="{{ prod.id }}" name="id">
                <div class="row mb-3">
                    <div class="col-md-6">
                        <div class="input-group">
                            <span class="input-group-text">SKU</span>
                            <input type="number" class="form-control" name="c-sku" value="{{ prod.sku }}">
                            <input type="submit" class="btn btn-secondary" name="btn-buscar" value="Buscar">
                        </div>
                    </div>
                </div>
                <div class="row mb-3">
                    <div class="col input-group">
                        <span class="input-group-text">Nombre</span>
                        <input class="form-control" type="text" name="txtNombre" value="{{ prod.nombre }}" />
                    </div>
                    <div class="col input-group">
                        <span class="input-group-text">Cantidad</span>
                        <input class="form-control" type="number" name="txtCantidad" value="{{ prod.cantidad }}">
                        <select class="form-select" aria-label="Unidad" name="sel-tipo" onchange="checkUn(this)">
                            {% for tipo in tipos %}
                                <option value="{{ tipo.id }}" {% if tipo.id == prod.tipo.id %}selected{% endif %}>{{ tipo.abr }}</option>
                            {% endfor %}
                            <option value="add">** Añadir Tipo Unidad **</option>
                        </select>
                        <input class="btn btn-secondary" type="sumbit" value="Editar" name="btn-mod-unidad"></button>
                    </div>
                </div>
                <div class="row mb-3">
                    <div class="col input-group">
                        <span class="input-group-text">Descripcion</span>
                        <input class="form-control" name="txtDesc" type="text" value="{{ prod.descripcion }}">
                    </div>
                    <div class="col input-group">
                        <span class="input-group-text">Proveedor</span>
                        <select class="form-select" name="sel-prov" onchange="checkProv(this)">
                            {% for prov in proveedores %}
                                <option value="{{ prov.id }}" {% if prov.id == prod.proveedor.id %}selected{% endif %}>{{ prov.nombre }}</option>
                            {% endfor %}
                            <option value="add">** Añadir Proveedor **</option>
                        </select>
                        <input type="submit" class="btn btn-secondary" name="btn-mod-prov" value="Editar" >
                    </div>
                </div>
                <div class="row mb-3">
                    <div class="col align-items-center d-flex">
                        <div class=" form-check form-switch">
                            <label class="form-check-label">Alerta Bajo stock</label>
                            <input class="form-check-input" type="checkbox" role="switch" name="bajoStockCheck" {% if prod.alerta_bajo %}checked{% endif %}>
                        </div>
                    </div>
                    <div class="col input-group">
                        <span class="input-group-text">Bajo stock</span>
                        <input name="txtBajoStock" class="form-control" type="text">
                    </div>
                </div>
                <div class="row mb-3">
                    <div class="col align-items-center d-flex">
                        <div class=" form-check form-switch">
                            <label class="form-check-label">Alerta Sobre stock</label>
                            <input class="form-check-input" type="checkbox" role="switch" name="sobreStockCheck" {% if prod.alerta_sobre %}checked{% endif %}>
                        </div>
                    </div>
                    <div class="col input-group">
                        <span class="input-group-text">Sobre stock</span>
                        <input name="txtSobreStock" class="form-control" type="text">
                    </div>
                </div>
                <div class="row mb-3">
                    <div class="col">
                        <input class="btn btn-success" name="btn-guardar" type="submit" value="Guardar">
                    </div>
                    <div class="col input-group">
                        <input class="btn btn-danger" name="btn-eliminar" type="submit" value="Eliminar">
                        <input type="submit" value="Limpiar" class="btn btn-secondary" name="btn-limpiar">
                    </div>
                </div>
            </form>
            <div>
                <h1 class="titulo">Listado de Productos</h1>
                <form class="lista-productos" method="post">
                    {% csrf_token %}
                    <table class="table table-sm table-responsive table-hover table-bordered">
                        <thead class="">
                            <tr class="table-primary">
                                <th scope="col">Codigo</th>
                                <th scope="col">Producto</th>
                                <th scope="col">Proveedor</strong></th>
                                <th scope="col">Stock</strong></th>
                                <th scope="col">Seleccionar</th>
                            </tr>
                        </thead>
                        <tbody class="table-group-divider" id="lista">
                        </tbody>
                    </table>
                </form>
            </div>
        </div>
    </div>
</div>
<script>
    $(document).ready(function () {
        $.get("/api/items", function (data) {
            $.each(data.results, function (i, value) {
                $("#lista").append("<tr id='tr-" + value.sku + "'>" +
                    "<td>" + value.sku + "</td>" +
                    "<td>" + value.nombre + "</td>" +
                    "<td id='prov-"+value.sku+"'></td>" +
                    "<td id='tipo-"+value.sku+"'>" + value.cantidad + "</td>" +
                    "<td><input type='radio' id='rb-" + value.sku + "' name='sel-prod' class='form-check-input' value='" + value.sku + "' onclick='this.form.submit()' ></td></tr>");
                $.get(value.proveedor,function(data){
                    $("#prov-"+value.sku).append("<label>"+data.nombre+"</label>");
                });
                $.get(value.tipo,function(data){
                    $("#tipo-"+value.sku).addClass(data.cssclass);
                });
            });
        });
    });
</script>

{% endblock %}

{% block toast %}
{% if resp != "" %}
<div class="toast align-items-center text-white {{ resp_tipo }} border-0" role="alert" aria-live="assertive"
    aria-atomic="true">
    <div class="d-flex">
        <div class="toast-body">
            {{ resp }}
        </div>
        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"
            aria-label="Close"></button>
    </div>
</div>
{% endif %}
{% endblock %}